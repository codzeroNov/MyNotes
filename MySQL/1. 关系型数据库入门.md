### 规范化

#### 1、未规范化的数据存在的问题

+ 数据冗余度大，主要由于属性之间的约束关系太强导致。

+ 修改异常。

+ 插入与删除异常。

#### 2、规范化后的数据的好处

+ 数据量减少

+ 表达能力增强

+ 修改方便

---

### 常用的三大范式

#### 1、第一范式（1NF）

在任何一个关系数据库中，第一范式（1NF）是对关系模式的基本要求，不满足第一范式（1NF）的数据库就不是关系数据库。

所谓第一范式（1NF）是指数据库表的每一列都是不可分割的基本数据项，同一列中不能有多个值，即实体中的某个属性不能有多个值或者不能有重复的属性。如果出现重复的属性，就可能需要定义一个新的实体，新的实体由重复的属性构成，新实体与原实体之间为一对多关系。在第一范式（1NF）中表的每一行只包含一个实例的信息。例如，员工信息表，不能将员工信息都放在一列中显示，也不能将其中的两列或多列在一列中显示；员工信息表的每一行只表示一个员工的信息，一个员工的信息在表中只出现一次。简而言之，第一范式就是无重复的列。

#### 2、第二范式（2NF）

第二范式（2NF）是在第一范式（1NF）的基础上建立起来的，即满足第二范式（2NF）必须先满足第一范式（1NF）。第二范式（2NF）要求数据库表中的每个实例或行必须可以被惟一地区分。为实现区分通常需要为表加上一个列，以存储各个实例的惟一标识。如员工信息表中加上了员工编号（emp_id）列，因为每个员工的员工编号是惟一的，因此每个员工可以被惟一区分。这个惟一属性列被称为主关键字或主键、主码。

第二范式（2NF）要求实体的属性完全依赖于主关键字。所谓完全依赖是指不能存在仅依赖主关键字一部分的属性，如果存在，那么这个属性和主关键字的这一部分应该分离出来形成一个新的实体，新实体与原实体之间是一对多的关系。为实现区分通常需要为表加上一个列，以存储各个实例的惟一标识。简而言之，第二范式就是非主属性非部分依赖于主关键字。

#### 3、第三范式（3NF）

满足第三范式（3NF）必须先满足第二范式（2NF）。简而言之，第三范式（3NF）要求一个数据库表中不包含已在其它表中已包含的非主关键字信息。例如，存在一个部门信息表，其中每个部门有部门编号（dept_id）、部门名称、部门简介等信息。那么在员工信息表中列出部门编号后就不能再将部门名称、部门简介等与部门有关的信息再加入员工信息表中。如果不存在部门信息表，则根据第三范式（3NF）也应该构建它，否则就会有大量的数据冗余。简而言之，第三范式就是属性不依赖于其它非主属性。

---

### 数据库事务的性质

#### 原子性(Atomicity)

事务中的所有操作作为一个整体像原子一样不可分割，要么全部成功,要么全部失败。

#### 一致性(Consistency)

事务的执行结果必须使数据库从一个一致性状态到另一个一致性状态。

> 一致性状态是指:1.系统的状态满足数据的完整性约束(主码，参照完整性，check约束等) 2.系统的状态反应数据库本应描述的现实世界的真实状态,比如转账前后两个账户的金额总和应该保持不变。

#### 隔离性(Isolation)

并发执行的事务不会相互影响，其对数据库的影响和它们串行执行时一样。比如多个用户同时往一个账户转账，最后账户的结果应该和他们按先后次序转账的结果一样。

#### 持久性(Durability)

事务一旦提交,其对数据库的更新就是持久的。任何事务或系统故障都不会导致数据丢失。

---

### 事务的隔离级别

#### 读未提交(READ UNCOMMITTED)

允许事务读取未被其他事务提交的变更数据。

#### 读提交(READ COMMITTED)

只允许事务读取已经被其他事务提交的变更数据。

#### 可重复读(REPEATABLE READ)

确保事务可以多次从一个字段中读取相同的值，在此事务持续期间，禁止其他事务对此字段的更新。

#### 串行化(SERIALIZABLE)

确保事务可以从一个表中读取相同的行，在这个事务持续期间，禁止其他事务对该表执行插入、更新和删除操作，可避免所有并发问题，但性能非常低。

#### 事务并行状态下可能存在的问题

+ **脏读**：事务T1读取了已经被事务T2修改但还未提交的字段，由于某种原因，T2事物回滚，则T1读取的内容是临时且无效的。

+ **不可重复读**：T1读取一个字段，之后T2更新了该字段，T1在此读取该字段值发生了变化。

+ **幻读**：T1从一个表中读取了一个字段，然后T2在该表中插入了一些新的行，之后T1在此读取该表会多出几行。

  > 脏读和不可重复读：脏读是读取了另一个未提交事务的修改，而不可重复读是读取了前一个事务提交的记录。

| 隔离级别 | 脏读 | 不可重复读 | 幻读 |
| :------: | :--: | :--------: | :--: |
| 读未提交 |  是  |     是     |  是  |
|  读提交  |  否  |     是     |  是  |
| 可重复读 |  否  |     否     |  是  |
|  串行化  |  否  |     否     |  否  |

